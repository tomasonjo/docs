---
title: Auth-aware tool responses
description: Format tool responses to trigger OAuth flows and resume execution automatically.
sidebarTitle: Auth responses
mode: wide
---

Some tools require user authorization (for example, Google, Slack, GitHub). Agent Builder includes middleware to detect when a tool needs authorization and to pause the run with a clear prompt to the user. After the user completes auth, the same tool call is retried automatically.

## Return shape to request auth

If a tool detects missing authorization, return a JSON string containing the following fields:

```json
{
  "auth_required": true,
  "auth_url": "https://auth.example.com/start",
  "auth_id": "opaque-tracking-id"
}
```

- `auth_required`: set to `true` to signal an interrupt is needed.
- `auth_url`: where the user should be redirected to authorize.
- `auth_id`: optional correlation ID to track the auth session.

Agent Builder will interrupt the run, render the auth UI, and upon completion resume and retry the same tool call.

<Note>
Return the JSON as the tool's textual output. Avoid mixing it with other content. The platform parses the JSON and triggers the correct flow.
</Note>

## Server headers and custom auth

When calling remote MCP servers, Agent Builder preserves `Authorization` and other headers you configured for that server. For the default built‑in server, the platform uses an internal service key and refreshes it automatically.

To route calls correctly:

- Include `metadata.mcp_server_url` on tools you create so the platform can apply the right headers.
- Or, when authoring tool configuration files (for example, `/tools.json` for sub‑agents), set `mcp_server_url` alongside the tool name.

